#!/bin/bash

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
#  PRIVESC CHECK - Automated Linux Privilege Escalation Enumeration
#  @3diklab | Pack 1000 Subs
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
#
#  DISCLAIMER: Este script es para uso รTICO รNICAMENTE en entornos autorizados
#  (HTB, OSCP labs, pentesting con autorizaciรณn escrita).
#
#  USO: ./privesc_check.sh
#  OUTPUT: Genera reporte en privesc_report_$(date +%s).txt
#
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

# Colors
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
MAGENTA='\033[0;35m'
CYAN='\033[0;36m'
NC='\033[0m' # No Color

REPORT_FILE="privesc_report_$(date +%s).txt"

# Banner
echo -e "${CYAN}"
cat << "EOF"
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                                                           โ
โ   โโโโโโโ โโโโโโโ โโโโโโ   โโโโโโโโโโโโโโโโโโโ โโโโโโโ   โ
โ   โโโโโโโโโโโโโโโโโโโโโโ   โโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ   โโโโโโโโโโโโโโโโโโโโโโ   โโโโโโโโโ  โโโโโโโโโโโ        โ
โ   โโโโโโโ โโโโโโโโโโโโโโโ โโโโโโโโโโ  โโโโโโโโโโโ        โ
โ   โโโ     โโโ  โโโโโโ โโโโโโโ โโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ   โโโ     โโโ  โโโโโโ  โโโโโ  โโโโโโโโโโโโโโโโ โโโโโโโ   โ
โ                                                           โ
โ   Linux Privilege Escalation Enumeration                 โ
โ   @3diklab | Pack 1000 Subs                              โ
โ                                                           โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
EOF
echo -e "${NC}"

echo -e "${BLUE}[*] Starting privilege escalation enumeration...${NC}"
echo -e "${BLUE}[*] Report will be saved to: ${GREEN}$REPORT_FILE${NC}\n"

# Function to print section headers
section() {
    echo -e "\n${MAGENTA}โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ${NC}"
    echo -e "${MAGENTA}  $1${NC}"
    echo -e "${MAGENTA}โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ${NC}\n"
    echo "" >> "$REPORT_FILE"
    echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ" >> "$REPORT_FILE"
    echo "  $1" >> "$REPORT_FILE"
    echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ" >> "$REPORT_FILE"
    echo "" >> "$REPORT_FILE"
}

# Function to check and display results
check() {
    local cmd="$1"
    local description="$2"
    echo -e "${YELLOW}[+] $description${NC}"
    echo "[+] $description" >> "$REPORT_FILE"
    echo "Command: $cmd" >> "$REPORT_FILE"
    eval "$cmd" 2>/dev/null | tee -a "$REPORT_FILE"
    echo "" >> "$REPORT_FILE"
}

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# SYSTEM INFORMATION
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
section "SYSTEM INFORMATION"

check "whoami" "Current user"
check "id" "User ID and groups"
check "hostname" "Hostname"
check "uname -a" "Kernel version"
check "cat /etc/os-release 2>/dev/null || cat /etc/issue" "OS version"

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# SUDO PRIVILEGES - HIGH PRIORITY
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
section "SUDO PRIVILEGES (HIGH PRIORITY)"

check "sudo -l" "Sudo commands allowed"
echo -e "${GREEN}[!] Check GTFOBins for sudo exploits: https://gtfobins.github.io/${NC}"

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# SUID/SGID BINARIES - HIGH PRIORITY
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
section "SUID/SGID BINARIES (HIGH PRIORITY)"

check "find / -perm -4000 -type f 2>/dev/null" "SUID binaries (4000)"
check "find / -perm -2000 -type f 2>/dev/null" "SGID binaries (2000)"
echo -e "${GREEN}[!] Check GTFOBins for SUID exploits: https://gtfobins.github.io/${NC}"

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# CAPABILITIES - OFTEN OVERLOOKED
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
section "CAPABILITIES (OFTEN OVERLOOKED)"

check "getcap -r / 2>/dev/null" "Files with capabilities"
echo -e "${GREEN}[!] Look for cap_setuid+ep (can escalate to root)${NC}"

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# WRITABLE FILES & DIRECTORIES
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
section "WRITABLE FILES & DIRECTORIES"

check "find / -writable -type f 2>/dev/null | grep -v '/proc/' | grep -v '/sys/' | head -20" "Writable files (first 20)"
check "find / -writable -type d 2>/dev/null | grep -v '/proc/' | grep -v '/sys/' | head -20" "Writable directories (first 20)"
check "ls -la /etc/passwd /etc/shadow /etc/sudoers 2>/dev/null" "Check /etc critical files"

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# CRON JOBS
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
section "CRON JOBS"

check "cat /etc/crontab" "/etc/crontab"
check "ls -la /etc/cron* 2>/dev/null" "Cron directories"
check "crontab -l 2>/dev/null" "User crontab"
check "cat /var/spool/cron/crontabs/* 2>/dev/null" "Other users' crontabs"

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# RUNNING PROCESSES & SERVICES
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
section "RUNNING PROCESSES & SERVICES"

check "ps aux | grep root" "Processes running as root"
check "netstat -tulpn 2>/dev/null || ss -tulpn" "Listening ports"

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# KERNEL EXPLOITS
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
section "KERNEL EXPLOITS"

KERNEL=$(uname -r)
echo -e "${YELLOW}[+] Current kernel: $KERNEL${NC}"
echo "[+] Current kernel: $KERNEL" >> "$REPORT_FILE"
echo -e "${GREEN}[!] Search for exploits:${NC}"
echo "    - searchsploit kernel $KERNEL"
echo "    - https://github.com/SecWiki/linux-kernel-exploits"
echo "" >> "$REPORT_FILE"

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# PASSWORDS & CREDENTIALS
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
section "PASSWORDS & CREDENTIALS"

check "grep -ri 'password' /var/www/html 2>/dev/null | head -10" "Passwords in /var/www/html (first 10)"
check "find /home -name '*.txt' -o -name '*.bak' -o -name '*.conf' 2>/dev/null | head -20" "Interesting files in /home (first 20)"
check "cat ~/.bash_history 2>/dev/null | grep -i 'pass\|pwd\|user'" "Bash history for credentials"
check "env | grep -i 'pass\|pwd\|key'" "Environment variables"

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# SSH KEYS
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
section "SSH KEYS"

check "find / -name 'id_rsa' -o -name 'id_dsa' 2>/dev/null" "Private SSH keys"
check "find / -name 'authorized_keys' 2>/dev/null" "Authorized keys"
check "ls -la ~/.ssh/ 2>/dev/null" "Current user SSH directory"

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# NFS SHARES
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
section "NFS SHARES"

check "cat /etc/exports 2>/dev/null" "NFS exports"
echo -e "${GREEN}[!] Look for 'no_root_squash' - can mount as root${NC}"

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# DOCKER / CONTAINERS
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
section "DOCKER / CONTAINERS"

check "groups | grep -E 'docker|lxd|lxc'" "Docker/LXD group membership"
check "docker ps 2>/dev/null" "Running containers"
echo -e "${GREEN}[!] If in docker group: docker run -v /:/mnt --rm -it alpine chroot /mnt bash${NC}"

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# PATH HIJACKING
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
section "PATH HIJACKING"

check "echo $PATH" "Current PATH"
check "find / -writable -type d 2>/dev/null | grep -E '^/usr/local|^/opt' | head -10" "Writable directories in PATH"

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# FINISH
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

echo -e "\n${GREEN}โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ${NC}"
echo -e "${GREEN}[โ] Enumeration complete!${NC}"
echo -e "${GREEN}[โ] Report saved to: $REPORT_FILE${NC}"
echo -e "${GREEN}โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ${NC}\n"

echo -e "${CYAN}Next steps:${NC}"
echo -e "  1. Review $REPORT_FILE"
echo -e "  2. Focus on: SUDO, SUID, CAPABILITIES"
echo -e "  3. Use GTFOBins: https://gtfobins.github.io/"
echo -e "  4. Check kernel exploits: searchsploit kernel $(uname -r)"
echo -e "\n${YELLOW}Good luck! ๐ถ๏ธ  @3diklab${NC}\n"
